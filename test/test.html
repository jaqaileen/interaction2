<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.13.1/lodash.js'></script>
  <link href="https://fonts.cdnfonts.com/css/forma-djr-banner" rel="stylesheet">
                
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 280vh;
      background: linear-gradient(to bottom, #133414 20%, #F5F5F5 60%);
      background-size: cover;
      background-repeat: no-repeat;
    }

    svg {
      position: absolute;
      padding-left: 36%;
      top: 138%;
      width: 62vw;
      height: 134vh;
    }
    
    .flex-container {
        padding-left: 4%;
        width: 30%;
        height: 58%;
        text-align: left;
        display: flex;
        justify-content: space-between;
    }

    .content {
        text-align: left;
    }

    h1 {
        position: absolute;
        top: 30%;
        font-family: 'Perandory', sans-serif;
        font-weight: 100;
        font-size: 5rem;
        color: #E7AFC7;
    }

    h2 {
        position: relative;
        font-family: 'Forma DJR Display', sans-serif;
        font-style: normal;
        top: 10%;
        font-weight: 500;
        font-size: 1.6rem;
        color: #E7AFC7;
        margin-bottom: 2%;
        margin-top: 90%;
        letter-spacing: 0.1rem;
    }

    .svg-row {
      position: relative;
      display: flex;
      justify-content: space-between; 
      z-index: 100;
    }

    p {
        font-family: 'Forma DJR Banner', sans-serif;
        font-style: normal;
        font-weight: 400;
        font-size: 1rem;
        letter-spacing: 0.1rem;
        margin: 0;
        color: #133414;
        position: relative;
        left: 50%;
        bottom: 10%; 
        transform: translateX(-50%);
        padding-top: 1%;
    }

    .rectangle {
        position: relative;
        width: 100%;
        top: 29%;
        height: 37.5%;
        border: 3px solid #133414;
        background-color: transparent;
        border-radius: 15px;
    }

    .flower circle { 
      mix-blend-mode: multiply; 
      z-index: 100;
    }

    .grid-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        padding: 20px;
        box-sizing: border-box;
        z-index: 100;
    }

    #type-info {
    position: fixed;
    display: none;
    width: 110%;
    height: 110%;
    z-index: 50;
    background-color:#133414; /* Set background opacity to 30% */
    backdrop-filter: blur(300px);
    z-index: 200;
    border-radius: 70px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

  #type-text {
      font-family: 'Perandory', sans-serif;
      font-weight: 100;
      font-size: 7.5rem;
      color: #E7AFC7;
      text-align: center;
      position: absolute;
      top: 43%;
      left: 50%;
      z-index: 200;
      transform: translate(-50%, -80%);
      opacity: 1; /* Set opacity to 100% */
  }




  </style>
</head>

<body>
     <div class="flex-container">
        <div class="content">
          <h1>Flowers of <br> New York City</h1>    
          <h2>New York City's spontaneous vascular plant flora includes 2,029 species spread across 160 families and 726 genera.
            <br> <br>
            Among these families, the Grasses (Poaceae), Daisies (Asteraceae), and Sedges (Cyperaceae) stand out as the most species-rich, each boasting 200 or more species. These families represent the largest plant families within New York City's flora. </h2>
            <div class="rectangle">
            <p style="top: 1.5%; margin-bottom: 5%; font-weight: 600; text-align: center;">Seasons in bloom:</p>
            <div class="svg-row" style="width: 95%; left: 2.5%;">
                <img src="../assets/Ellipse 1.svg" alt="Ellipse 1" style="width: 12%; height: auto;">
                <img src="../assets/Ellipse 2.svg" alt="Ellipse 2" style="width: 12%; height: auto;">
                <img src="../assets/Ellipse 3.svg" alt="Ellipse 3" style="width: 12%; height: auto;">
                <img src="../assets/Ellipse 4.svg" alt="Ellipse 4" style="width: 12%; height: auto;">
            </div>
            <p style="top: 1.3%">
              <span style="display: inline-block; width: 1.2%;"></span>
              spring<span style="display: inline-block; width: 15%;"></span>
              summer<span style="display: inline-block; width: 12.6%;"></span>
              autumn<span style="display: inline-block; width: 15%;"></span>
              winter
            </p>
            <p style="top: 6%; margin-bottom: 5%; font-weight: 600; text-align: center;">Colors:</p>
            <div class="svg-row" style="top: 4.2%; width: 100%; left:0.1%">
              <img src="../assets/Ellipse 10.svg" alt="Ellipse 10" style="width: 16%; height: auto;">
              <img src="../assets/Ellipse 11.svg" alt="Ellipse 11" style="width: 16%; height: auto;">
              <img src="../assets/Ellipse 12.svg" alt="Ellipse 12" style="width: 16%; height: auto;">
              <img src="../assets/Ellipse 13.svg" alt="Ellipse 13" style="width: 16%; height: auto;">
              <img src="../assets/Ellipse 14.svg" alt="Ellipse 14" style="width: 16%; height: auto;">
            </div>
            <p style="top: 4.9%">
              <span style="display: inline-block; width: 3.5%;"></span>
              pink<span style="display: inline-block; width: 14%;"></span>
              red<span style="display: inline-block; width: 11.5%;"></span>
              purple<span style="display: inline-block; width: 9%;"></span>
              green<span style="display: inline-block; width: 9%;"></span>
              yellow
            </p>
            <p style="top: 9.8%; margin-bottom: 5%; font-weight: 600; text-align: center;">Quantity of plant families:</p>
            <div class="svg-row" style="top: 8.4%; left: 1%; width: 96%;">
              <img src="../assets/Group 9.svg" alt="flower 1" style="height: 12%; width: auto;">
              <img src="../assets/Group 8.svg" alt="flower 2" style="height: 12%; width: auto;">
              <img src="../assets/Group 7.svg" alt="flower 3" style="height: 12%; width: auto;">
              <img src="../assets/Group 6.svg" alt="flower 4" style="height: 12%; width: auto;">
          </div>
          <p style="top: 9.5%">
            <span style="display: inline-block; width:7.5%;"></span>
            >20<span style="display: inline-block; width: 17.5%;"></span>
            >50<span style="display: inline-block; width: 16.5%;"></span>
            >150<span style="display: inline-block; width: 15%;"></span>
            >250
          </p>
        </div>
        </div>
    </div>
    <div class="grid-container">
        <svg id="flowers"></svg>
    </div>

    <div id="type-info"> 
    <h1 id="type-text"></h1>
  </div>
    
  <script>
    var padding = 20;
    var svg = d3.select('svg')
    	.append('g')
    	.attr('transform', 'translate(' + [padding, padding] + ')');
    var flowerSize = 150;
		var petalPaths = [[
    	'M0,0',
      "C50,50 50,100 0,100",
      "C-50,100 -50,50 0,0"
    ],
    [
			'M-35,0',
      'C-25,25 25,25 35,0',
      'C50,25 25,75 0,100',
      'C-25,75 -50,25 -35,0'
    ],
    [
      'M0,0',
      'C50,40 50,70 20,100',
      'L0,85',
      'L-20,100',
      'C-50,70 -50,40 0,0'
    ],
    [
      'M0,0',
      'C50,25 50,75 0,100',
      'C-50,75 -50,25 0,0'
    ]];

    var numPetalScale = d3.scaleQuantize()
    	.range(_.range(5, 15));
    var flowerSizeScale = d3.scaleLinear()
    	.range([.003, .03]);
    var petalScale = d3.scaleOrdinal()
    	.range(_.range(4));
    var petalColors = d3.scaleOrdinal()
    	.range(['#D2A816', '#CC7B9D', '#38903C', '#A71B1B', '#7854A6']);

    
    // blurring of the colored circles
    var defs = svg.append("defs");
    defs.append("filter")
      .attr("id", "motionFilter") 	// unique ID
      .attr("width", "300%")		//Increase the width of the filter region to remove blur "boundary"
      .attr("x", "-100%") 			//Make sure the center of the "width" lies in the middle of the element
      .append("feGaussianBlur")	//Append a filter technique
      .attr("in", "SourceGraphic")	//Perform the blur on the applied element
      .attr("stdDeviation", "8 8");	//Do a blur of 8 standard deviations in the horizontal and vertical direction

    d3.json('./movies.json', function(movies) {
      movies = _.chain(movies)
      	.map(function(movie) {
        	movie.year = parseInt(movie.Year);
          movie.genres = movie.Genre.split(', ');
          movie.rating = parseFloat(movie.imdbRating);
          movie.votes = parseInt(movie.imdbVotes.replace(',', ''));

          return movie;
        }).sortBy(function(movie) {
        	return -movie.year
        }).value();
      
      // number of petals depending on number of rating votes
      var minVotes = d3.min(movies, function(d) {return d.votes});
      var maxVotes = d3.max(movies, function(d) {return d.votes});
      numPetalScale.domain([minVotes, maxVotes]);
      var topGenres = _.chain(movies)
      	.map('genres').flatten()
      	.countBy().toPairs()
      	.sortBy(1).map(0)
      	.takeRight(4)
      	.value();
      // topGenres.push('Other');
      // petalColors.domain(topGenres);

      

    // var path = petalPaths[petalScale(d3.Rated)];
    // return _.times(numPetals, function(i) {
    //     return {
    //         scale: flowerSizeScale(d3.rating),
    //         angle: (360/numPetals) * i,
    //         path: path
    //     };
    // });




      var flowers = svg.selectAll('g.flower')
      .data(_.values(movies)).enter().append('g')
      .classed('flower', true) 
      .attr('transform', function(d, i) {
        var scale = flowerSizeScale(d.rating);
        var row = Math.floor(i / 4); //flower in each row
        var col = i % 4; // flower in each column
        var x = col * (flowerSize + 0.4 * flowerSize) + (flowerSize * 0.2); // aft flowerSize the decimal determines spacing
        var y = row * (flowerSize + 0.4 * flowerSize) + (flowerSize * 0.2); // ^
        return 'translate(' + x + ',' + y +
            ')scale(' + scale + ')';
    });

      // create the data for each flower's colors
      flowers.selectAll('circle')
      	.data(function(d) {
        	// if there's only one genre, center the circle
        	var cy = d.genres.length === 1 ? 0 : -flowerSize / 5;
        	return _.map(d.genres, function(genre, i) {
            genre = _.includes(topGenres, genre) ? genre : 'Other';
            return {
              cy: cy,
              scale: flowerSizeScale(d.rating),
              angle: (360/d.genres.length) * i,
              fill: petalColors(genre)
            }
          });
        }).enter().append('circle')
      	.attr('cy', function(d) {return d.cy})
        .attr('r', flowerSize / 2)
      	.attr('fill', function(d) {return d.fill})
      	.attr('transform', function(d) {
          var x = flowerSize / 2 / d.scale;
          var y = flowerSize / 2 / d.scale;
          return 'translate(' + [x, y] +
            ')rotate(' + d.angle + ')';
        }).style("filter", "url(#motionFilter)");
      
      flowers.selectAll('path')
        .data(function(d) {
        	// var numPetals = numPetalScale(d.votes);

          var numPetals = 5; // Default number of petals
    if (d.votes > 20 && d.votes < 50) {
        numPetals = 6;
    } else if (d.votes >= 50 && d.votes < 150) {
        numPetals = 7;
    } else if (d.votes >= 150 && d.votes < 250) {
        numPetals = 8;
    }
        	var path = petalPaths[petalScale(d.Rated)];
          return _.times(numPetals, function(i) {
            return {
              scale: flowerSizeScale(d.rating),
              angle: (360/numPetals) * i,
              path: path
            }
          });
        }).enter().append('path')
        .attr('stroke', '#323232')
        .attr('stroke-width', function(d) {
        	return 3 / d.scale;
        }).attr('fill', 'none')
        .attr('d', function(d) {return d.path})
        .attr('transform', function(d) {
          var cx = flowerSize / 2 / d.scale;
          var cy = flowerSize / 2 / d.scale;
          return 'translate(' + [cx, cy] +
            ')rotate(' + [d.angle] + ')';
        })

    d3.selectAll('g.flower') // Select all flower SVG elements
            .on('mouseover', function(d) { // Mouseover event handler
                var type = d.Type; // Get the type of the flower
                d3.select('#type-text').text(type); // Update the text of the type-info div
                d3.select('#type-info, #type-text').style('display', 'block'); // Show the type-info div
            })
            .on('mouseout', function() { // Mouseout event handler
                d3.select('#type-info, #type-text').style('display', 'none'); // Hide the type-info div
            });

          });

    // Define a function to filter the movies based on genre
function filterMoviesByGenre(genre) {
    return _.chain(movies)
        .filter(['Genre', genre])
        .value();
}

// Update the function that creates the flowers to filter the movies based on the selected genre
function createFlowers(genre) {
    var filteredMovies = filterMoviesByGenre(genre);

    // Your existing code to create flowers goes here, but use filteredMovies instead of movies
    // ...

    // Example:
    var flowers = svg.selectAll('g.flower')
        .data(_.values(filteredMovies))
        .enter().append('g')
        .classed('flower', true)
        // Remaining code...
}


// Call the filter function when Ellipse 1 is clicked
d3.select('#ellipse1').on('click', function() {
    var genre = 'Other'; // The genre to filter by
    createFlowers(genre);
});
  </script>
</body>
